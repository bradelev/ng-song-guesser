"use strict";(self.webpackChunkng_song_guesser=self.webpackChunkng_song_guesser||[]).push([[60],{6060:(gt,S,i)=>{i.r(S),i.d(S,{GuessTheSongComponent:()=>ct});var b=i(7414),g=i(6895),t=i(8274),l=i(433),P=i(7579),O=i(1135),f=i(4004),Z=i(4707),G=i(3099);function _(n,o,e){let s,a=!1;return n&&"object"==typeof n?({bufferSize:s=1/0,windowTime:o=1/0,refCount:a=!1,scheduler:e}=n):s=n??1/0,(0,G.B)({connector:()=>new Z.t(s,o,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}var m=i(8505),u=i(3900),I=i(9646),w=i(9751),v=i(4049),A=i(3532);function d(n=0,o,e=v.P){let s=-1;return null!=o&&((0,A.K)(o)?e=o:s=o),new w.y(a=>{let c=function N(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;c<0&&(c=0);let h=0;return e.schedule(function(){a.closed||(a.next(h++),0<=s?this.schedule(void 0,s):a.complete())},c)})}var U=i(2529),F=i(9841),x=i(5698),k=i(9300),E=i(7272),W=i(4482),j=i(5403),Y=i(5032),J=i(9718),L=i(5577);function T(n,o){return o?e=>(0,E.z)(o.pipe((0,x.q)(1),function z(){return(0,W.e)((n,o)=>{n.subscribe((0,j.x)(o,Y.Z))})}()),e.pipe(T(n))):(0,L.z)((e,s)=>n(e,s).pipe((0,x.q)(1),(0,J.h)(e)))}var R=i(263),y=i(529),r=i(8598);let D=(()=>{class n{constructor(){this._http=(0,t.f3M)(y.eN)}getSongs(){console.log("esto no deberia ejecutarse mas de una vez");const e=(new y.WM).append("appKey","YOUR_APP_KEY");return this._http.get(`${r.g.API_URL}/song/${r.g.SONGS_OPTIONS}`,{headers:e})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var K=i(9576),C=i(7340);let M=(()=>{class n{constructor(){this.elRef=(0,t.f3M)(t.SBq),this.builder=(0,t.f3M)(C._j),this.randomWord="Loading..."}ngOnInit(){}startAnimation(e){this.randomWord=e,this.player||this.prepareAnimation(),this.playAnimation()}prepareAnimation(){const e=this.builder.build([(0,C.jt)("1s ease-in-out",(0,C.oB)({transform:"scale3d(1.5, 1.5, 1)",opacity:0}))]),s=this.elRef.nativeElement.querySelector("svg");this.player=e.create(s)}playAnimation(){this.player.play(),this.player.onDone(()=>{this.player.reset()})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-feedback-word"]],standalone:!0,features:[t.jDz],decls:8,vars:2,consts:[["role","img"],[1,"title"],["x","50%","y","50%","text-anchor","middle","fill","#222","stroke","#222","stroke-width","1.5%","dominant-baseline","central","stroke-linecap","round",1,"word"],["x","50%","y","50%","text-anchor","middle","fill","white","dominant-baseline","central",1,"word"]],template:function(e,s){1&e&&(t.TgZ(0,"h1"),t.O4$(),t.TgZ(1,"svg",0)(2,"title",1),t._uU(3,"Random Words!"),t.qZA(),t.TgZ(4,"text",2),t._uU(5),t.qZA(),t.TgZ(6,"text",3),t._uU(7),t.qZA()()()),2&e&&(t.xp6(5),t.Oqu(s.randomWord),t.xp6(2),t.Oqu(s.randomWord))},dependencies:[g.ez],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%], h1[_ngcontent-%COMP%]{height:100%;width:100%}body[_ngcontent-%COMP%]{transition:background-color .3s ease-in;font-family:Open Sans,sans-serif;overflow:hidden;font-size:12px}@media (min-width: 480px){body[_ngcontent-%COMP%]{font-size:14px}}@media (min-width: 640px){body[_ngcontent-%COMP%]{font-size:16px}}.word[_ngcontent-%COMP%]{font-family:Bangers,cursive}svg[_ngcontent-%COMP%]{height:100%;width:100%;position:relative;top:-1rem;animation:pop-out 1s ease-in-out infinite}.word[_ngcontent-%COMP%]{font-family:Bangers,cursive;letter-spacing:.05em;color:#fff;padding:.5em;font-size:28px}@media (min-width: 480px){.word[_ngcontent-%COMP%]{font-size:36px}}@media (min-width: 640px){.word[_ngcontent-%COMP%]{font-size:48px}}@media (min-width: 960px){.word[_ngcontent-%COMP%]{font-size:64px}}@media (min-width: 1280px){.word[_ngcontent-%COMP%]{font-size:84px}}p[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;line-height:2rem;text-align:center;color:#ffffffbf;background-color:#222}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited{color:inherit}"]}),n})();function V(n,o){1&n&&t._UZ(0,"app-feedback-word")}function X(n,o){if(1&n&&(t.TgZ(0,"p",15),t._uU(1," Your team is "),t.TgZ(2,"strong"),t._uU(3),t.qZA()()),2&n){const e=o.ngIf;t.xp6(3),t.Oqu(e.name)}}function B(n,o){if(1&n&&(t.TgZ(0,"div",16)(1,"span",17),t._uU(2),t.qZA()()),2&n){const e=o.ngIf;t.xp6(2),t.Oqu(e)}}function H(n,o){1&n&&(t.TgZ(0,"span"),t._uU(1,"Loading..."),t.qZA())}function q(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",18)(1,"input",19),t.NdJ("click",function(){const c=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.onSubmit(c.id))}),t.qZA(),t.TgZ(2,"label",20),t._uU(3),t.qZA()()}if(2&n){const e=o.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("id","song-"+e.id)("value",e.id)("disabled",s.isGameOver),t.xp6(1),t.ekj("pointer-events-none",s.isGameOver),t.Q6J("for","song-"+e.id),t.xp6(1),t.AsE(" ",e.name," ",e.id," ")}}function tt(n,o){if(1&n&&(t.TgZ(0,"div",23)(1,"div",24),t._uU(2),t.qZA(),t.O4$(),t.TgZ(3,"svg",25),t._UZ(4,"circle",26),t.qZA()()),2&n){const e=t.oxw().ngIf;t.xp6(2),t.Oqu(e)}}function et(n,o){1&n&&(t.TgZ(0,"span",17),t._uU(1,"Time's up!"),t.qZA())}function nt(n,o){1&n&&(t.TgZ(0,"span",17),t._uU(1,"Game Over"),t.qZA())}function ot(n,o){if(1&n&&(t.TgZ(0,"div",16),t.YNc(1,et,2,0,"span",27),t.YNc(2,nt,2,0,"span",27),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!e.isGameOver),t.xp6(1),t.Q6J("ngIf",e.isGameOver)}}function st(n,o){if(1&n&&(t.ynx(0),t.YNc(1,tt,5,1,"div",21),t.YNc(2,ot,3,2,"ng-template",null,22,t.W1O),t.BQk()),2&n){const e=o.ngIf,s=t.MAs(3),a=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e>0&&!a.isGameOver)("ngIfElse",s)}}const it=function(n,o){return{"opacity-50":n,"cursor-not-allowed":o}};function at(n,o){if(1&n&&(t.TgZ(0,"div",2)(1,"div",3)(2,"div",4),t.YNc(3,V,1,0,"app-feedback-word",5),t.qZA(),t.YNc(4,X,4,1,"p",6),t.TgZ(5,"div",7)(6,"p"),t._uU(7),t.qZA(),t.TgZ(8,"p"),t._uU(9),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.qZA()(),t.TgZ(12,"form",8)(13,"div",9),t.YNc(14,B,3,1,"div",10),t.YNc(15,H,2,0,"ng-template",null,11,t.W1O),t.qZA(),t.TgZ(17,"div",12),t.YNc(18,q,4,8,"div",13),t.qZA()(),t.TgZ(19,"div",14),t.YNc(20,st,4,2,"ng-container",5),t.qZA()()()),2&n){const e=o.ngIf,s=t.MAs(16),a=t.oxw();t.xp6(3),t.Q6J("ngIf",a.showFeedback),t.xp6(1),t.Q6J("ngIf",e.selectedTeam),t.xp6(3),t.hij("Attempts: ",a.attempts," / 3"),t.xp6(2),t.hij("Played Games: ",a.playedGames,""),t.xp6(2),t.hij("Total Score: ",a.totalScore,""),t.xp6(1),t.Q6J("formGroup",a.songsForm)("ngClass",t.WLB(11,it,a.isGameOver,a.isGameOver)),t.xp6(2),t.Q6J("ngIf",e.currentPhrase)("ngIfElse",s),t.xp6(4),t.Q6J("ngForOf",e.songs),t.xp6(2),t.Q6J("ngIf",e.timer)}}function rt(n,o){1&n&&(t.TgZ(0,"div",4),t._UZ(1,"app-feedback-word"),t.qZA())}let ct=(()=>{class n{constructor(){this._router=(0,t.f3M)(b.F0),this._fb=(0,t.f3M)(l.qu),this._document=(0,t.f3M)(g.K0),this._authService=(0,t.f3M)(R.e),this._songsService=(0,t.f3M)(D),this._userService=(0,t.f3M)(K.f),this.attempts=0,this.playedGames=1,this.totalScore=0,this.isGameOver=!1,this.teamCode="",this.randomSongPosId=Math.floor(Math.random()*r.g.SONGS_OPTIONS),this.showFeedback=!1,this._songCorrect$=new P.x,this._resetTimer$=new O.X(!0),this._stopCondition$=new O.X(!1),this.authState$=this._authService.authState$,this._songs$=this._songsService.getSongs().pipe((0,f.U)(e=>this._getSongOptions(e,0,r.g.SONGS_OPTIONS)),_()),this._lyrics$=this._songs$.pipe((0,m.b)(e=>console.log(e)),(0,u.w)(e=>(this.correctSong=e[this.randomSongPosId],(0,I.of)(e[this.randomSongPosId].lyrics||[])))),this._timer$=this._resetTimer$.pipe((0,u.w)(()=>d(0,r.g.COUNTDOWN_INTERVAL)),(0,f.U)(e=>r.g.COUNTDOWN_SECONDS-e),(0,m.b)(e=>{0===e&&this._gameOver()})),this._currentPhrase$=function $(n=0,o=v.z){return n<0&&(n=0),d(n,n,o)}(r.g.PHRASE_INTERVAL).pipe((0,U.o)(()=>!this._stopCondition$.getValue()),(0,u.w)(()=>this._lyrics$),(0,f.U)(e=>e[Math.floor(Math.random()*e.length)])),this.vm$=(0,F.a)([this._authService.authState$,this._authService.isLoggedIn$,this._authService.selectedTeam$,this._songs$,this._timer$,this._currentPhrase$]).pipe((0,f.U)(([e,s,a,c,h,p])=>({authState:e,isLoggedIn:s,selectedTeam:a,songs:c,timer:h,currentPhrase:p}))),this.songsForm=this._fb.group({songChoice:[null]})}ngOnInit(){this.authState$.subscribe(e=>{e||this._router.navigate(["/login"])})}onSubmit(e){this.attempts++,console.log(e,this.correctSong.id),Number(e)===this.correctSong.id?(console.log("isCorrect -> ",this.randomSongPosId),this.playedGames++,this.totalScore+=1===this.attempts?5:2===this.attempts?3:1,console.log("FEEDBACK MESSAGE: totalScore => ",this.totalScore),this.setFeedback("Correct!"),this.attempts=0,d(1e3).subscribe(s=>{this.randomSongPosId=Math.floor(Math.random()*r.g.SONGS_OPTIONS),this._stopCondition$.next(!1),this._songCorrect$.next(),this._resetCountdown(),this.songsForm.reset(),this._songs$=this._songsService.getSongs().pipe((0,m.b)(a=>console.log(a)),(0,f.U)(a=>this._getSongOptions(a,this.randomSongPosId,r.g.SONGS_OPTIONS)),_())})):(this._toggleClass("form.bg-white.shadow-md.rounded","shake-error",r.g.COUNTDOWN_INTERVAL),console.log("incorrect => ",Number(e),this.randomSongPosId),2===this.attempts&&this.setFeedback("Last Chance!")),this.attempts>=3&&(this.setFeedback("Game Over!"),this._gameOver())}setFeedback(e){this.showFeedback=!0,d(0).subscribe(s=>{this.randomWordComponent.startAnimation(e)}),d(1e3).subscribe(s=>{this.showFeedback=!1})}_resetCountdown(){this._resetTimer$.next(!0),this._toggleClass("#countdown svg","active",r.g.COUNTDOWN_INTERVAL/2)}_toggleClass(e,s,a){const c=this._document.querySelector(e);c?.classList.toggle(s),setTimeout(()=>{c?.classList.toggle(s)},a)}_gameOver(){this.isGameOver=!0,this._stopCondition$.next(!0),this._authService.authState$.pipe((0,x.q)(1),(0,k.h)(e=>!!e),(0,m.b)(e=>{this._userService.updateUserScore({email:e.email,playedGames:this.playedGames,totalScore:this.totalScore})}),function Q(n,o=v.z){const e=d(n,o);return T(()=>e)}(3e3)).subscribe(()=>{this._router.navigate(["/ranking"])})}_getSongOptions(e,s,a){const p=e.filter((ht,lt)=>lt!==s).sort(()=>Math.random()-.5).slice(0,a-1);return this.correctSong=e[s],this.correctSong&&p.push(this.correctSong),p.sort(()=>Math.random()-.5)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-guess-the-song"]],viewQuery:function(e,s){if(1&e&&t.Gf(M,5),2&e){let a;t.iGM(a=t.CRH())&&(s.randomWordComponent=a.first)}},standalone:!0,features:[t.jDz],decls:4,vars:4,consts:[["class","flex flex-col items-center justify-center mb-6",4,"ngIf","ngIfElse"],["loadingData",""],[1,"flex","flex-col","items-center","justify-center","mb-6"],[1,"w-full","max-w-xl","mx-auto"],[1,"feedback-container"],[4,"ngIf"],["class","my-5 text-center",4,"ngIf"],[1,"text-center","mb-4"],[1,"bg-white","shadow-md","rounded","px-8","pt-6","pb-8","text-black",3,"formGroup","ngClass"],[1,"mb-6"],["class","text-center",4,"ngIf","ngIfElse"],["loading",""],[1,"flex","flex-col"],["class","radio mb-2",4,"ngFor","ngForOf"],[1,"w-full","h-4","mt-4"],[1,"my-5","text-center"],[1,"text-center"],[1,"font-bold"],[1,"radio","mb-2"],["hidden","hidden","type","radio","formControlName","songChoice",3,"id","value","disabled","click"],[1,"px-2","py-1","rounded-lg","flex","justify-center","items-center","font-bold","w-full","h-10","lg:h-14","hover:cursor-pointer",3,"for"],["id","countdown",4,"ngIf","ngIfElse"],["timesUp",""],["id","countdown"],["id","countdown-number"],[1,"active"],["r","18","cx","20","cy","20"],["class","font-bold",4,"ngIf"]],template:function(e,s){if(1&e&&(t.YNc(0,at,21,14,"div",0),t.ALo(1,"async"),t.YNc(2,rt,2,0,"ng-template",null,1,t.W1O)),2&e){const a=t.MAs(3);t.Q6J("ngIf",t.lcZ(1,2,s.vm$))("ngIfElse",a)}},dependencies:[g.ez,g.mk,g.sg,g.O5,g.Ov,l.UX,l._Y,l.Fj,l._,l.JJ,l.JL,l.sg,l.u,M],styles:[".radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%]{background-color:#e9e1e1;color:#2f4f4f}.radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{background-color:#46e616;color:#fff}.feedback-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:150px;justify-content:center;width:100%}#countdown[_ngcontent-%COMP%]{position:relative;margin:50px auto auto;height:40px;width:40px;text-align:center}#countdown-number[_ngcontent-%COMP%]{color:#fff;display:inline-block;line-height:40px}svg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:40px;height:40px;transform:rotateY(-180deg) rotate(-90deg)}svg[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke-dasharray:113px;stroke-dashoffset:0px;stroke-linecap:round;stroke-width:2px;stroke:#fff;fill:none}svg.active[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_countdown 30s linear forwards}@keyframes _ngcontent-%COMP%_countdown{0%{stroke-dashoffset:0px}to{stroke-dashoffset:113px}}form.shake-error[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_horizontal-shaking .3s linear forwards}@keyframes _ngcontent-%COMP%_horizontal-shaking{0%{transform:translate(0)}25%{transform:translate(10px)}50%{transform:translate(-10px)}75%{transform:translate(10px)}to{transform:translate(0)}}"]}),n})()}}]);