"use strict";(self.webpackChunkng_song_guesser=self.webpackChunkng_song_guesser||[]).push([[566],{6566:(at,S,i)=>{i.r(S),i.d(S,{GuessTheSongComponent:()=>rt});var G=i(1034),l=i(6895),t=i(8256),a=i(433),C=i(7579),I=i(1135),h=i(5698),u=i(8505),g=i(4004),_=i(8675),T=i(3900),$=i(9751),p=i(4049),A=i(3532);function f(e=0,s,n=p.P){let o=-1;return null!=s&&((0,A.K)(s)?n=s:o=s),new $.y(r=>{let c=function P(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;c<0&&(c=0);let d=0;return n.schedule(function(){r.closed||(r.next(d++),0<=o?this.schedule(void 0,o):r.complete())},c)})}var N=i(2529),b=i(9841),w=i(9300),Y=i(7272),E=i(4482),J=i(5403),j=i(5032),F=i(9718),Q=i(5577);function O(e,s){return s?n=>(0,Y.z)(s.pipe((0,h.q)(1),function L(){return(0,E.e)((e,s)=>{e.subscribe((0,J.x)(s,j.Z))})}()),n.pipe(O(e))):(0,Q.z)((n,o)=>e(n,o).pipe((0,h.q)(1),(0,F.h)(n)))}var W=i(263),M=i(529);let D=(()=>{class e{constructor(){this._http=(0,t.f3M)(M.eN)}getSongs(){const n=(new M.WM).append("appKey","YOUR_APP_KEY");return this._http.get("http://137.184.76.157:3000/song/10",{headers:n})}getLyrics(n){return this.getSongs().pipe((0,g.U)(o=>o.find(r=>r.id===n)),(0,g.U)(o=>o?.lyrics??[]))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var K=i(8562);function k(e,s){if(1&e&&(t.TgZ(0,"p",13),t._uU(1," Your team is "),t.TgZ(2,"strong"),t._uU(3),t.qZA()()),2&e){const n=s.ngIf;t.xp6(3),t.Oqu(n.name)}}function B(e,s){if(1&e&&(t.TgZ(0,"div")(1,"span",14),t._uU(2),t.qZA()()),2&e){const n=s.ngIf;t.xp6(2),t.Oqu(n)}}function R(e,s){1&e&&(t.TgZ(0,"div"),t._uU(1,"Loading..."),t.qZA())}function V(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"div",15)(1,"input",16),t.NdJ("click",function(){t.CHM(n);const r=t.oxw(2);return t.KtG(r.onSubmit())}),t.qZA(),t.TgZ(2,"label",17),t._uU(3),t.qZA()()}if(2&e){const n=s.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("id","song-"+n.id)("value",n.id)("disabled",o.isGameOver),t.xp6(1),t.ekj("pointer-events-none",o.isGameOver),t.Q6J("for","song-"+n.id),t.xp6(1),t.hij(" ",n.name," ")}}function X(e,s){if(1&e&&(t.TgZ(0,"div",20)(1,"div",21),t._uU(2),t.qZA(),t.O4$(),t.TgZ(3,"svg",22),t._UZ(4,"circle",23),t.qZA()()),2&e){const n=t.oxw().ngIf;t.xp6(2),t.Oqu(n)}}function H(e,s){1&e&&(t.TgZ(0,"span",14),t._uU(1,"Time's up!"),t.qZA())}function q(e,s){1&e&&(t.TgZ(0,"span",14),t._uU(1,"Game Over"),t.qZA())}function tt(e,s){if(1&e&&(t.TgZ(0,"div",24),t.YNc(1,H,2,0,"span",25),t.YNc(2,q,2,0,"span",25),t.qZA()),2&e){const n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!n.isGameOver),t.xp6(1),t.Q6J("ngIf",n.isGameOver)}}function nt(e,s){if(1&e&&(t.ynx(0),t.YNc(1,X,5,1,"div",18),t.YNc(2,tt,3,2,"ng-template",null,19,t.W1O),t.BQk()),2&e){const n=s.ngIf,o=t.MAs(3),r=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n>0&&!r.isGameOver)("ngIfElse",o)}}const et=function(e,s){return{"opacity-50":e,"cursor-not-allowed":s}};function ot(e,s){if(1&e&&(t.TgZ(0,"div",1)(1,"div",2),t.YNc(2,k,4,1,"p",3),t.TgZ(3,"div",4)(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA(),t.TgZ(8,"p"),t._uU(9),t.qZA()(),t.TgZ(10,"form",5)(11,"div",6),t.YNc(12,B,3,1,"div",7),t.YNc(13,R,2,0,"ng-template",null,8,t.W1O),t.qZA(),t.TgZ(15,"div",9),t.YNc(16,V,4,7,"div",10),t.qZA()(),t.TgZ(17,"div",11),t.YNc(18,nt,4,2,"ng-container",12),t.qZA()()()),2&e){const n=s.ngIf,o=t.MAs(14),r=t.oxw();t.xp6(2),t.Q6J("ngIf",n.selectedTeam),t.xp6(3),t.hij("Attempts: ",r.attempts," / 3"),t.xp6(2),t.hij("Played Games: ",r.playedGames,""),t.xp6(2),t.hij("Total Score: ",r.totalScore,""),t.xp6(1),t.Q6J("formGroup",r.songsForm)("ngClass",t.WLB(10,et,r.isGameOver,r.isGameOver)),t.xp6(2),t.Q6J("ngIf",n.currentPhrase)("ngIfElse",o),t.xp6(4),t.Q6J("ngForOf",n.songs),t.xp6(2),t.Q6J("ngIf",n.timer)}}let rt=(()=>{class e{constructor(){this._router=(0,t.f3M)(G.F0),this._fb=(0,t.f3M)(a.qu),this._document=(0,t.f3M)(l.K0),this._authService=(0,t.f3M)(W.e),this._songsService=(0,t.f3M)(D),this._userService=(0,t.f3M)(K.f),this.attempts=0,this.playedGames=1,this.totalScore=0,this.isGameOver=!1,this.teamCode="",this.randomSongId=Math.floor(8*Math.random())+1,this._resetTimer$=new C.x,this._songCorrect$=new C.x,this._stopCondition$=new I.X(!1),this._lyrics$=this._getLyrics(this.randomSongId),this.authState$=this._authService.authState$,this._songs$=this._songsService.getSongs().pipe((0,h.q)(1),(0,u.b)(()=>console.log("entro aca _songs$")),(0,g.U)(n=>this._getSongOptions(n,this.randomSongId,5))),this._timer$=this._resetTimer$.pipe((0,_.O)(void 0),(0,u.b)(()=>console.log("entro aca _timer$")),(0,T.w)(()=>f(0,1e3)),(0,g.U)(n=>30-n)),this._currentPhrase$=function U(e=0,s=p.z){return e<0&&(e=0),f(e,e,s)}(5e3).pipe((0,N.o)(()=>!this._stopCondition$.getValue()),(0,_.O)(0),(0,T.w)(()=>this._lyrics$),(0,g.U)(n=>n[Math.floor(Math.random()*n.length)])),this.vm$=(0,b.a)([this._authService.authState$,this._authService.isLoggedIn$,this._authService.selectedTeam$,this._songs$,this._timer$,this._currentPhrase$]).pipe((0,g.U)(([n,o,r,c,d,m])=>({authState:n,isLoggedIn:o,selectedTeam:r,songs:c,timer:d,currentPhrase:m}))),this.songsForm=this._fb.group({songChoice:[null]})}ngOnInit(){this.authState$.subscribe(n=>{n||this._router.navigate(["/login"])})}onSubmit(){this.attempts++;const n=this.songsForm.get("songChoice")?.value;Number(n)===this.randomSongId?(console.log("isCorrect -> ",this.randomSongId),this.playedGames++,this.totalScore+=1===this.attempts?5:2===this.attempts?3:1,console.log("FEEDBACK MESSAGE: totalScore => ",this.totalScore),f(1e3).subscribe(o=>{this.attempts=0,this.randomSongId=Math.floor(8*Math.random())+1,this._stopCondition$.next(!1),this._songCorrect$.next(),this._resetCountdown()})):(this._toggleClass("form.bg-white.shadow-md.rounded","shake-error",1e3),console.log("incorrect => ",Number(n),this.randomSongId)),this.attempts>=3&&this._gameOver()}_resetCountdown(){this._resetTimer$.next(void 0),this._toggleClass("#countdown svg","active",500)}_toggleClass(n,o,r){const c=this._document.querySelector(n);c?.classList.toggle(o),setTimeout(()=>{c?.classList.toggle(o)},r)}_gameOver(){this.isGameOver=!0,this._stopCondition$.next(!0),this._authService.authState$.pipe((0,h.q)(1),(0,w.h)(n=>!!n),(0,u.b)(n=>{this._userService.updateUserScore({email:n.email,playedGames:this.playedGames,totalScore:this.totalScore})}),function z(e,s=p.z){const n=f(e,s);return O(()=>n)}(3e3)).subscribe(()=>{this._router.navigate(["/ranking"])})}_getLyrics(n){return this._songsService.getLyrics(n).pipe((0,g.U)(o=>this._shuffleArray(o)))}_getSongOptions(n,o,r){const m=n.filter(x=>x.id!==o).sort(()=>Math.random()-.5).slice(0,r-1),y=n.find(x=>x.id===o);y&&m.push(y);const Z=m.sort(()=>Math.random()-.5);return console.log({finalChoices:Z}),Z}_shuffleArray(n){for(let o=n.length-1;o>0;o--){const r=Math.floor(Math.random()*(o+1));[n[o],n[r]]=[n[r],n[o]]}return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-guess-the-song"]],standalone:!0,features:[t.jDz],decls:2,vars:3,consts:[["class","flex flex-col items-center justify-center mb-6",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","mb-6"],[1,"w-full","max-w-xl","mx-auto"],["class","my-5 text-center",4,"ngIf"],[1,"text-center","mb-4"],[1,"bg-white","shadow-md","rounded","px-8","pt-6","pb-8","text-black",3,"formGroup","ngClass"],[1,"mb-6"],[4,"ngIf","ngIfElse"],["loading",""],[1,"flex","flex-col"],["class","radio mb-2",4,"ngFor","ngForOf"],[1,"w-full","h-4","mt-4"],[4,"ngIf"],[1,"my-5","text-center"],[1,"font-bold"],[1,"radio","mb-2"],["hidden","hidden","type","radio","formControlName","songChoice",3,"id","value","disabled","click"],[1,"px-2","py-1","rounded-lg","flex","justify-center","items-center","font-bold","w-full","h-10","lg:h-14","hover:cursor-pointer",3,"for"],["id","countdown",4,"ngIf","ngIfElse"],["timesUp",""],["id","countdown"],["id","countdown-number"],[1,"active"],["r","18","cx","20","cy","20"],[1,"text-center"],["class","font-bold",4,"ngIf"]],template:function(n,o){1&n&&(t.YNc(0,ot,19,13,"div",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,o.vm$))},dependencies:[l.ez,l.mk,l.sg,l.O5,l.Ov,a.UX,a._Y,a.Fj,a._,a.JJ,a.JL,a.sg,a.u],styles:[".radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%]{background-color:#e9e1e1;color:#2f4f4f}.radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{background-color:#46e616;color:#fff}#countdown[_ngcontent-%COMP%]{position:relative;margin:50px auto auto;height:40px;width:40px;text-align:center}#countdown-number[_ngcontent-%COMP%]{color:#fff;display:inline-block;line-height:40px}svg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:40px;height:40px;transform:rotateY(-180deg) rotate(-90deg)}svg[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke-dasharray:113px;stroke-dashoffset:0px;stroke-linecap:round;stroke-width:2px;stroke:#fff;fill:none}svg.active[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_countdown 30s linear forwards}@keyframes _ngcontent-%COMP%_countdown{0%{stroke-dashoffset:0px}to{stroke-dashoffset:113px}}form.shake-error[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_horizontal-shaking .3s linear forwards}@keyframes _ngcontent-%COMP%_horizontal-shaking{0%{transform:translate(0)}25%{transform:translate(10px)}50%{transform:translate(-10px)}75%{transform:translate(10px)}to{transform:translate(0)}}"]}),e})()}}]);