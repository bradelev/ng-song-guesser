"use strict";(self.webpackChunkng_song_guesser=self.webpackChunkng_song_guesser||[]).push([[813],{8813:(lt,_,i)=>{i.r(_),i.d(_,{GuessTheSongComponent:()=>ct});var G=i(7414),l=i(6895),t=i(8274),g=i(433),I=i(7579),S=i(1135),m=i(4004),Z=i(4707),M=i(3099),p=i(8505),u=i(3900),y=i(9646),N=i(9751),v=i(4049),P=i(3532);function h(n=0,o,e=v.P){let s=-1;return null!=o&&((0,P.K)(o)?e=o:s=o),new N.y(a=>{let r=function $(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;r<0&&(r=0);let f=0;return e.schedule(function(){a.closed||(a.next(f++),0<=s?this.schedule(void 0,s):a.complete())},r)})}var A=i(2529),U=i(9841),x=i(5698),F=i(9300),Y=i(7272),k=i(4482),E=i(5403),J=i(5032),j=i(9718),L=i(5577);function C(n,o){return o?e=>(0,Y.z)(o.pipe((0,x.q)(1),function Q(){return(0,k.e)((n,o)=>{n.subscribe((0,E.x)(o,J.Z))})}()),e.pipe(C(n))):(0,L.z)((e,s)=>n(e,s).pipe((0,x.q)(1),(0,j.h)(e)))}var c=i(8598),R=i(263),T=i(529);let D=(()=>{class n{constructor(){this._http=(0,t.f3M)(T.eN)}getSongs(){const e=(new T.WM).append("appKey","YOUR_APP_KEY");return this._http.get(`${c.g.API_URL}/song/${c.g.SONGS_OPTIONS}`,{headers:e})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var V=i(9576),O=i(1604);function z(n,o){1&n&&t._UZ(0,"app-feedback-word")}function K(n,o){if(1&n&&(t.TgZ(0,"p",10),t._uU(1," Your team is "),t.TgZ(2,"strong"),t._uU(3),t.qZA()()),2&n){const e=o.ngIf;t.xp6(3),t.Oqu(e.name)}}function X(n,o){if(1&n&&(t.TgZ(0,"div",17)(1,"span",18),t._uU(2),t.qZA()()),2&n){const e=o.ngIf;t.xp6(2),t.Oqu(e)}}function H(n,o){1&n&&(t.TgZ(0,"span"),t._uU(1,"Loading..."),t.qZA())}function B(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",19)(1,"input",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit,f=t.oxw(3);return t.KtG(f.onSubmit(r.id))}),t.qZA(),t.TgZ(2,"label",21),t._uU(3),t.qZA()()}if(2&n){const e=o.$implicit,s=t.oxw(3);t.xp6(1),t.Q6J("id","song-"+e.id)("value",e.id)("disabled",s.isGameOver),t.xp6(1),t.ekj("pointer-events-none",s.isGameOver),t.Q6J("for","song-"+e.id),t.xp6(1),t.AsE(" ",e.name," ",e.id," ")}}const q=function(n,o){return{"opacity-50":n,"cursor-not-allowed":o}};function tt(n,o){if(1&n&&(t.TgZ(0,"form",11)(1,"div",12),t.YNc(2,X,3,1,"div",13),t.YNc(3,H,2,0,"ng-template",null,14,t.W1O),t.qZA(),t.TgZ(5,"div",15),t.YNc(6,B,4,8,"div",16),t.qZA()()),2&n){const e=t.MAs(4),s=t.oxw().ngIf,a=t.oxw();t.Q6J("formGroup",a.songsForm)("ngClass",t.WLB(5,q,a.isGameOver,a.isGameOver)),t.xp6(2),t.Q6J("ngIf",s.currentPhrase)("ngIfElse",e),t.xp6(4),t.Q6J("ngForOf",s.songs)}}function et(n,o){if(1&n&&(t.TgZ(0,"div",24)(1,"div",25),t._uU(2),t.qZA(),t.O4$(),t.TgZ(3,"svg",26),t._UZ(4,"circle",27),t.qZA()()),2&n){const e=t.oxw().ngIf;t.xp6(2),t.Oqu(e)}}function nt(n,o){1&n&&(t.TgZ(0,"span",18),t._uU(1,"Time's up!"),t.qZA())}function ot(n,o){1&n&&(t.TgZ(0,"span",18),t._uU(1,"Game Over"),t.qZA())}function st(n,o){if(1&n&&(t.TgZ(0,"div",17),t.YNc(1,nt,2,0,"span",28),t.YNc(2,ot,2,0,"span",28),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!e.isGameOver),t.xp6(1),t.Q6J("ngIf",e.isGameOver)}}function it(n,o){if(1&n&&(t.ynx(0),t.YNc(1,et,5,1,"div",22),t.YNc(2,st,3,2,"ng-template",null,23,t.W1O),t.BQk()),2&n){const e=o.ngIf,s=t.MAs(3),a=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e>0&&!a.isGameOver)("ngIfElse",s)}}function at(n,o){if(1&n&&(t.TgZ(0,"div",2)(1,"div",3)(2,"div",4),t.YNc(3,z,1,0,"app-feedback-word",5),t.qZA(),t.YNc(4,K,4,1,"p",6),t.TgZ(5,"div",7)(6,"p"),t._uU(7),t.qZA(),t.TgZ(8,"p"),t._uU(9),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.qZA()(),t.YNc(12,tt,7,8,"form",8),t.TgZ(13,"div",9),t.YNc(14,it,4,2,"ng-container",5),t.qZA()()()),2&n){const e=o.ngIf,s=t.oxw();t.xp6(3),t.Q6J("ngIf",s.showFeedback),t.xp6(1),t.Q6J("ngIf",e.selectedTeam),t.xp6(3),t.hij("Attempts: ",s.attempts," / 3"),t.xp6(2),t.hij("Played Games: ",s.playedGames,""),t.xp6(2),t.hij("Total Score: ",s.totalScore,""),t.xp6(1),t.Q6J("ngIf",s.showForm),t.xp6(2),t.Q6J("ngIf",e.timer)}}function rt(n,o){1&n&&(t.TgZ(0,"div",29),t._UZ(1,"app-feedback-word"),t.qZA())}let ct=(()=>{class n{constructor(){this._router=(0,t.f3M)(G.F0),this._fb=(0,t.f3M)(g.qu),this._document=(0,t.f3M)(l.K0),this._authService=(0,t.f3M)(R.e),this._songsService=(0,t.f3M)(D),this._userService=(0,t.f3M)(V.f),this.attempts=0,this.playedGames=1,this.totalScore=0,this.isGameOver=!1,this.teamCode="",this.randomSongPosId=Math.floor(Math.random()*c.g.SONGS_OPTIONS),this.showFeedback=!1,this.showForm=!0,this._songCorrect$=new I.x,this._resetTimer$=new S.X(!0),this._stopCondition$=new S.X(!1),this.authState$=this._authService.authState$,this._songs$=this._songsService.getSongs().pipe((0,m.U)(e=>this._getSongOptions(e,0,c.g.SONGS_OPTIONS)),function b(n,o,e){let s,a=!1;return n&&"object"==typeof n?({bufferSize:s=1/0,windowTime:o=1/0,refCount:a=!1,scheduler:e}=n):s=n??1/0,(0,M.B)({connector:()=>new Z.t(s,o,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}()),this._lyrics$=this._songs$.pipe((0,p.b)(e=>console.log(e)),(0,u.w)(e=>(this.correctSong=e[this.randomSongPosId],(0,y.of)(e[this.randomSongPosId].lyrics||[])))),this._timer$=this._resetTimer$.pipe((0,u.w)(()=>h(0,c.g.COUNTDOWN_INTERVAL)),(0,m.U)(e=>c.g.COUNTDOWN_SECONDS-e),(0,p.b)(e=>{0===e&&this._gameOver()})),this._currentPhrase$=function w(n=0,o=v.z){return n<0&&(n=0),h(n,n,o)}(c.g.PHRASE_INTERVAL).pipe((0,A.o)(()=>!this._stopCondition$.getValue()),(0,u.w)(()=>this._lyrics$),(0,m.U)(e=>e[Math.floor(Math.random()*e.length)])),this.vm$=(0,U.a)([this._authService.authState$,this._authService.isLoggedIn$,this._authService.selectedTeam$,this._songs$,this._timer$,this._currentPhrase$]).pipe((0,m.U)(([e,s,a,r,f,d])=>({authState:e,isLoggedIn:s,selectedTeam:a,songs:r,timer:f,currentPhrase:d}))),this.songsForm=this._fb.group({songChoice:[null]})}ngOnInit(){this.authState$.subscribe(e=>{e||this._router.navigate(["/login"])})}onSubmit(e){this.attempts++,console.log(e,this.correctSong.id),Number(e)===this.correctSong.id?(this.playedGames++,this.totalScore+=1===this.attempts?5:2===this.attempts?3:1,this.setFeedback("Correct!"),this.attempts=0,this.showForm=!1,h(1e3).subscribe(s=>{this.randomSongPosId=Math.floor(Math.random()*c.g.SONGS_OPTIONS),this._stopCondition$.next(!1),this._songCorrect$.next(),this._resetCountdown(),this.songsForm.reset(),this.showForm=!0})):(this._toggleClass("form.bg-white.shadow-md.rounded","shake-error",c.g.COUNTDOWN_INTERVAL),2===this.attempts&&this.setFeedback("Last Chance!")),this.attempts>=3&&(this.setFeedback("Game Over!"),this._gameOver())}setFeedback(e){this.showFeedback=!0,h(0).subscribe(s=>{this.randomWordComponent.startAnimation(e)}),h(1e3).subscribe(s=>{this.showFeedback=!1})}_resetCountdown(){this._resetTimer$.next(!0),this._toggleClass("#countdown svg","active",c.g.COUNTDOWN_INTERVAL/2)}_toggleClass(e,s,a){const r=this._document.querySelector(e);r?.classList.toggle(s),setTimeout(()=>{r?.classList.toggle(s)},a)}_gameOver(){this.isGameOver=!0,this._stopCondition$.next(!0),this._authService.authState$.pipe((0,x.q)(1),(0,F.h)(e=>!!e),(0,p.b)(e=>{this._userService.updateUserScore({email:e.email,playedGames:this.playedGames,totalScore:this.totalScore})}),function W(n,o=v.z){const e=h(n,o);return C(()=>e)}(3e3)).subscribe(()=>{this._router.navigate(["/ranking"])})}_getSongOptions(e,s,a){const d=e.filter((ft,gt)=>gt!==s).sort(()=>Math.random()-.5).slice(0,a-1);return this.correctSong=e[s],this.correctSong&&d.push(this.correctSong),d.sort(()=>Math.random()-.5)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-guess-the-song"]],viewQuery:function(e,s){if(1&e&&t.Gf(O.U,5),2&e){let a;t.iGM(a=t.CRH())&&(s.randomWordComponent=a.first)}},standalone:!0,features:[t.jDz],decls:4,vars:4,consts:[["class","flex flex-col items-center justify-center mb-6",4,"ngIf","ngIfElse"],["loadingData",""],[1,"flex","flex-col","items-center","justify-center","mb-6"],[1,"w-full","max-w-xl","mx-auto"],[1,"feedback-container"],[4,"ngIf"],["class","my-5 text-center",4,"ngIf"],[1,"text-center","mb-4"],["class","bg-white shadow-md rounded px-8 pt-6 pb-8 text-black",3,"formGroup","ngClass",4,"ngIf"],[1,"w-full","h-4","mt-4"],[1,"my-5","text-center"],[1,"bg-white","shadow-md","rounded","px-8","pt-6","pb-8","text-black",3,"formGroup","ngClass"],[1,"mb-6"],["class","text-center",4,"ngIf","ngIfElse"],["loading",""],[1,"flex","flex-col"],["class","radio mb-2",4,"ngFor","ngForOf"],[1,"text-center"],[1,"font-bold"],[1,"radio","mb-2"],["hidden","hidden","type","radio","formControlName","songChoice",3,"id","value","disabled","click"],[1,"px-2","py-1","rounded-lg","flex","justify-center","items-center","font-bold","w-full","h-10","lg:h-14","hover:cursor-pointer",3,"for"],["id","countdown",4,"ngIf","ngIfElse"],["timesUp",""],["id","countdown"],["id","countdown-number"],[1,"active"],["r","18","cx","20","cy","20"],["class","font-bold",4,"ngIf"],[1,"feedback-container","animate__animated","animate__bounce","animate__infinite"]],template:function(e,s){if(1&e&&(t.YNc(0,at,15,7,"div",0),t.ALo(1,"async"),t.YNc(2,rt,2,0,"ng-template",null,1,t.W1O)),2&e){const a=t.MAs(3);t.Q6J("ngIf",t.lcZ(1,2,s.vm$))("ngIfElse",a)}},dependencies:[l.ez,l.mk,l.sg,l.O5,l.Ov,g.UX,g._Y,g.Fj,g._,g.JJ,g.JL,g.sg,g.u,O.U],styles:[".radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%]{background-color:#e9e1e1;color:#2f4f4f}.radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{background-color:#46e616;color:#fff}.feedback-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:150px;justify-content:center;width:100%}#countdown[_ngcontent-%COMP%]{position:relative;margin:50px auto auto;height:40px;width:40px;text-align:center}#countdown-number[_ngcontent-%COMP%]{color:#fff;display:inline-block;line-height:40px}svg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:40px;height:40px;transform:rotateY(-180deg) rotate(-90deg)}svg[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke-dasharray:113px;stroke-dashoffset:0px;stroke-linecap:round;stroke-width:2px;stroke:#fff;fill:none}svg.active[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_countdown 30s linear forwards}@keyframes _ngcontent-%COMP%_countdown{0%{stroke-dashoffset:0px}to{stroke-dashoffset:113px}}form.shake-error[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_horizontal-shaking .3s linear forwards}@keyframes _ngcontent-%COMP%_horizontal-shaking{0%{transform:translate(0)}25%{transform:translate(10px)}50%{transform:translate(-10px)}75%{transform:translate(10px)}to{transform:translate(0)}}"]}),n})()}}]);