"use strict";(self.webpackChunkng_song_guesser=self.webpackChunkng_song_guesser||[]).push([[813],{8813:(ct,x,i)=>{i.r(x),i.d(x,{GuessTheSongComponent:()=>rt});var M=i(7414),l=i(6895),t=i(8274),c=i(433),y=i(7579),S=i(1135),f=i(5698),Z=i(4707),G=i(3099),h=i(4004),C=i(8505),T=i(3900),P=i(9751),d=i(4049),$=i(3532);function m(e=0,o,n=d.P){let s=-1;return null!=o&&((0,$.K)(o)?n=o:s=o),new P.y(r=>{let a=function A(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;a<0&&(a=0);let g=0;return n.schedule(function(){r.closed||(r.next(g++),0<=s?this.schedule(void 0,s):r.complete())},a)})}var U=i(2529),b=i(9841),E=i(9300),j=i(7272),Y=i(4482),J=i(5403),w=i(5032),F=i(9718),L=i(5577);function _(e,o){return o?n=>(0,j.z)(o.pipe((0,f.q)(1),function Q(){return(0,Y.e)((e,o)=>{e.subscribe((0,J.x)(o,w.Z))})}()),n.pipe(_(e))):(0,L.z)((n,s)=>e(n,s).pipe((0,f.q)(1),(0,F.h)(n)))}var R=i(263),O=i(529);let z=(()=>{class e{constructor(){this._http=(0,t.f3M)(O.eN)}getSongs(){console.log("esto no deberia ejecutarse mas de una vez");const n=(new O.WM).append("appKey","YOUR_APP_KEY");return this._http.get("http://137.184.76.157:3000/song/5",{headers:n})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=i(8562);function K(e,o){if(1&e&&(t.TgZ(0,"p",13),t._uU(1," Your team is "),t.TgZ(2,"strong"),t._uU(3),t.qZA()()),2&e){const n=o.ngIf;t.xp6(3),t.Oqu(n.name)}}function k(e,o){if(1&e&&(t.TgZ(0,"div",14)(1,"span",15),t._uU(2),t.qZA()()),2&e){const n=o.ngIf;t.xp6(2),t.Oqu(n)}}function V(e,o){1&e&&(t.TgZ(0,"span"),t._uU(1,"Loading..."),t.qZA())}function X(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"div",16)(1,"input",17),t.NdJ("click",function(){const a=t.CHM(n).$implicit,g=t.oxw(2);return t.KtG(g.onSubmit(a.id))}),t.qZA(),t.TgZ(2,"label",18),t._uU(3),t.qZA()()}if(2&e){const n=o.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("id","song-"+n.id)("value",n.id)("disabled",s.isGameOver),t.xp6(1),t.ekj("pointer-events-none",s.isGameOver),t.Q6J("for","song-"+n.id),t.xp6(1),t.AsE(" ",n.name," ",n.id," ")}}function H(e,o){if(1&e&&(t.TgZ(0,"div",21)(1,"div",22),t._uU(2),t.qZA(),t.O4$(),t.TgZ(3,"svg",23),t._UZ(4,"circle",24),t.qZA()()),2&e){const n=t.oxw().ngIf;t.xp6(2),t.Oqu(n)}}function B(e,o){1&e&&(t.TgZ(0,"span",15),t._uU(1,"Time's up!"),t.qZA())}function q(e,o){1&e&&(t.TgZ(0,"span",15),t._uU(1,"Game Over"),t.qZA())}function tt(e,o){if(1&e&&(t.TgZ(0,"div",14),t.YNc(1,B,2,0,"span",25),t.YNc(2,q,2,0,"span",25),t.qZA()),2&e){const n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!n.isGameOver),t.xp6(1),t.Q6J("ngIf",n.isGameOver)}}function nt(e,o){if(1&e&&(t.ynx(0),t.YNc(1,H,5,1,"div",19),t.YNc(2,tt,3,2,"ng-template",null,20,t.W1O),t.BQk()),2&e){const n=o.ngIf,s=t.MAs(3),r=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n>0&&!r.isGameOver)("ngIfElse",s)}}const et=function(e,o){return{"opacity-50":e,"cursor-not-allowed":o}};function ot(e,o){if(1&e&&(t.TgZ(0,"div",1)(1,"div",2),t.YNc(2,K,4,1,"p",3),t.TgZ(3,"div",4)(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA(),t.TgZ(8,"p"),t._uU(9),t.qZA()(),t.TgZ(10,"form",5)(11,"div",6),t.YNc(12,k,3,1,"div",7),t.YNc(13,V,2,0,"ng-template",null,8,t.W1O),t.qZA(),t.TgZ(15,"div",9),t.YNc(16,X,4,8,"div",10),t.qZA()(),t.TgZ(17,"div",11),t.YNc(18,nt,4,2,"ng-container",12),t.qZA()()()),2&e){const n=o.ngIf,s=t.MAs(14),r=t.oxw();t.xp6(2),t.Q6J("ngIf",n.selectedTeam),t.xp6(3),t.hij("Attempts: ",r.attempts," / 3"),t.xp6(2),t.hij("Played Games: ",r.playedGames,""),t.xp6(2),t.hij("Total Score: ",r.totalScore,""),t.xp6(1),t.Q6J("formGroup",r.songsForm)("ngClass",t.WLB(10,et,r.isGameOver,r.isGameOver)),t.xp6(2),t.Q6J("ngIf",n.currentPhrase)("ngIfElse",s),t.xp6(4),t.Q6J("ngForOf",n.songs),t.xp6(2),t.Q6J("ngIf",n.timer)}}let rt=(()=>{class e{constructor(){this._router=(0,t.f3M)(M.F0),this._fb=(0,t.f3M)(c.qu),this._document=(0,t.f3M)(l.K0),this._authService=(0,t.f3M)(R.e),this._songsService=(0,t.f3M)(z),this._userService=(0,t.f3M)(D.f),this.attempts=0,this.playedGames=1,this.totalScore=0,this.isGameOver=!1,this.teamCode="",this.randomSongPosId=Math.floor(5*Math.random()),this._songCorrect$=new y.x,this._resetTimer$=new S.X(!0),this._stopCondition$=new S.X(!1),this.authState$=this._authService.authState$,this._songs$=this._songsService.getSongs().pipe((0,f.q)(1),function I(e,o,n){let s,r=!1;return e&&"object"==typeof e?({bufferSize:s=1/0,windowTime:o=1/0,refCount:r=!1,scheduler:n}=e):s=e??1/0,(0,G.B)({connector:()=>new Z.t(s,o,n),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}(),(0,h.U)(n=>this._getSongOptions(n,0,5))),this._lyrics$=this._songs$.pipe((0,h.U)(n=>n[0].lyrics||[]),(0,C.b)(n=>console.log("lyrics",n))),this._timer$=this._resetTimer$.pipe((0,T.w)(()=>m(0,1e3)),(0,h.U)(n=>30-n)),this._currentPhrase$=function N(e=0,o=d.z){return e<0&&(e=0),m(e,e,o)}(5e3).pipe((0,U.o)(()=>!this._stopCondition$.getValue()),(0,T.w)(()=>this._lyrics$),(0,h.U)(n=>n[Math.floor(Math.random()*n.length)])),this.vm$=(0,b.a)([this._authService.authState$,this._authService.isLoggedIn$,this._authService.selectedTeam$,this._songs$,this._timer$,this._currentPhrase$]).pipe((0,h.U)(([n,s,r,a,g,u])=>({authState:n,isLoggedIn:s,selectedTeam:r,songs:a,timer:g,currentPhrase:u}))),this.songsForm=this._fb.group({songChoice:[null]})}ngOnInit(){this.authState$.subscribe(n=>{n||this._router.navigate(["/login"])})}onSubmit(n){this.attempts++,console.log(n,this.correctSong.id),Number(n)===this.correctSong.id?(console.log("isCorrect -> ",this.randomSongPosId),this.playedGames++,this.totalScore+=1===this.attempts?5:2===this.attempts?3:1,console.log("FEEDBACK MESSAGE: totalScore => ",this.totalScore),m(1e3).subscribe(s=>{this.attempts=0,this.randomSongPosId=Math.floor(5*Math.random()),this._stopCondition$.next(!1),this._songCorrect$.next(),this._resetCountdown()})):(this._toggleClass("form.bg-white.shadow-md.rounded","shake-error",1e3),console.log("incorrect => ",Number(n),this.randomSongPosId)),this.attempts>=3&&this._gameOver()}_resetCountdown(){this._resetTimer$.next(!0),this._toggleClass("#countdown svg","active",500)}_toggleClass(n,s,r){const a=this._document.querySelector(n);a?.classList.toggle(s),setTimeout(()=>{a?.classList.toggle(s)},r)}_gameOver(){this.isGameOver=!0,this._stopCondition$.next(!0),this._authService.authState$.pipe((0,f.q)(1),(0,E.h)(n=>!!n),(0,C.b)(n=>{this._userService.updateUserScore({email:n.email,playedGames:this.playedGames,totalScore:this.totalScore})}),function W(e,o=d.z){const n=m(e,o);return _(()=>n)}(3e3)).subscribe(()=>{this._router.navigate(["/ranking"])})}_getSongOptions(n,s,r){const u=n.filter((gt,at)=>at!==s).sort(()=>Math.random()-.5).slice(0,r-1);return this.correctSong=n[s],this.correctSong&&u.push(this.correctSong),u.sort(()=>Math.random()-.5)}_shuffleArray(n){for(let s=n.length-1;s>0;s--){const r=Math.floor(Math.random()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-guess-the-song"]],standalone:!0,features:[t.jDz],decls:2,vars:3,consts:[["class","flex flex-col items-center justify-center mb-6",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","mb-6"],[1,"w-full","max-w-xl","mx-auto"],["class","my-5 text-center",4,"ngIf"],[1,"text-center","mb-4"],[1,"bg-white","shadow-md","rounded","px-8","pt-6","pb-8","text-black",3,"formGroup","ngClass"],[1,"mb-6"],["class","text-center",4,"ngIf","ngIfElse"],["loading",""],[1,"flex","flex-col"],["class","radio mb-2",4,"ngFor","ngForOf"],[1,"w-full","h-4","mt-4"],[4,"ngIf"],[1,"my-5","text-center"],[1,"text-center"],[1,"font-bold"],[1,"radio","mb-2"],["hidden","hidden","type","radio","formControlName","songChoice",3,"id","value","disabled","click"],[1,"px-2","py-1","rounded-lg","flex","justify-center","items-center","font-bold","w-full","h-10","lg:h-14","hover:cursor-pointer",3,"for"],["id","countdown",4,"ngIf","ngIfElse"],["timesUp",""],["id","countdown"],["id","countdown-number"],[1,"active"],["r","18","cx","20","cy","20"],["class","font-bold",4,"ngIf"]],template:function(n,s){1&n&&(t.YNc(0,ot,19,13,"div",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,s.vm$))},dependencies:[l.ez,l.mk,l.sg,l.O5,l.Ov,c.UX,c._Y,c.Fj,c._,c.JJ,c.JL,c.sg,c.u],styles:[".radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%]{background-color:#e9e1e1;color:#2f4f4f}.radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{background-color:#46e616;color:#fff}#countdown[_ngcontent-%COMP%]{position:relative;margin:50px auto auto;height:40px;width:40px;text-align:center}#countdown-number[_ngcontent-%COMP%]{color:#fff;display:inline-block;line-height:40px}svg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:40px;height:40px;transform:rotateY(-180deg) rotate(-90deg)}svg[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke-dasharray:113px;stroke-dashoffset:0px;stroke-linecap:round;stroke-width:2px;stroke:#fff;fill:none}svg.active[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_countdown 30s linear forwards}@keyframes _ngcontent-%COMP%_countdown{0%{stroke-dashoffset:0px}to{stroke-dashoffset:113px}}form.shake-error[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_horizontal-shaking .3s linear forwards}@keyframes _ngcontent-%COMP%_horizontal-shaking{0%{transform:translate(0)}25%{transform:translate(10px)}50%{transform:translate(-10px)}75%{transform:translate(10px)}to{transform:translate(0)}}"]}),e})()}}]);